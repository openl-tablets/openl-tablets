name: Stale Issues and PRs

on:
  schedule:
    # Run daily at 1 AM UTC
    - cron: '0 1 * * *'
  workflow_dispatch:

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/stale@v9
        with:
          # Issue settings
          days-before-issue-stale: 90
          days-before-issue-close: 14
          stale-issue-label: 'stale'
          exempt-issue-labels: 'pinned,security,enhancement,good first issue,help wanted'
          stale-issue-message: |
            This issue has been automatically marked as stale because it has not had recent activity in the last 90 days.

            **It will be closed in 14 days if no further activity occurs.**

            If this issue is still relevant:
            - Comment on this issue to keep it open
            - Add the `pinned` label to prevent it from becoming stale again

            Thank you for your contributions to OpenL Tablets!
          close-issue-message: |
            This issue was automatically closed due to inactivity.

            If you believe this issue is still relevant, please:
            - Reopen the issue
            - Provide additional context or updates
            - Reference any related work

            Thank you for your understanding!

          # Pull Request settings
          days-before-pr-stale: 45
          days-before-pr-close: 7
          stale-pr-label: 'stale'
          exempt-pr-labels: 'pinned,security,WIP,blocked'
          stale-pr-message: |
            This pull request has been automatically marked as stale because it has not had recent activity in the last 45 days.

            **It will be closed in 7 days if no further activity occurs.**

            If this PR is still being worked on:
            - Push new commits or comment on this PR
            - Add the `WIP` label if work is in progress
            - Add the `blocked` label if waiting on external dependencies
            - Add the `pinned` label to prevent it from becoming stale again

            Thank you for your contributions!
          close-pr-message: |
            This pull request was automatically closed due to inactivity.

            If you plan to continue this work:
            - Reopen the PR
            - Rebase on the latest `main` branch
            - Address any merge conflicts

            We appreciate your contribution and hope to see it completed!

          # Operational settings
          operations-per-run: 100
          remove-stale-when-updated: true
          ascending: true

          # Labels to add when closing
          close-issue-label: 'auto-closed'
          close-pr-label: 'auto-closed'
