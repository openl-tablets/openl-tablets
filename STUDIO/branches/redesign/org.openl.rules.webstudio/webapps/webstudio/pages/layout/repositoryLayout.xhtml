<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

    <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}" />
    <c:set var="node" value="#{repositoryTreeState.selectedNode}" />
    <c:set var="artefact" value="#{node.data}" />

    <h:head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

        <link href="#{contextPath}/css/common.css" rel="stylesheet" />
        <link href="#{contextPath}/css/layout/main.css" rel="stylesheet" />
        <script src="#{contextPath}/javascript/common.js"></script>
        <script src="#{contextPath}/javascript/jquery-1.7.1.min.js"></script>
        <script src="#{contextPath}/javascript/jquery-ui-1.8.16.custom.min.js"></script>
        <script src="#{contextPath}/javascript/jquery.layout-1.3.0.js"></script>
        <h:outputScript name="jsf.js" library="javax.faces" />

        <script>
            var $j = $.noConflict();

            // Handle JSF / Richfaces AJAX errors
            var onError = function onError(data) {
                handleError(data.responseCode);
            };
            jsf.ajax.addOnError(onError);

            $j(function () {
                setLayoutDimensions();

                $j(window).resize(function() {
                    setLayoutDimensions();
                });

                $j("#center").layout({
                    spacing_open: 1,
                    west__size: 230
                });
                $j("body").css({"visibility": "visible"});
            });

            function handleError(code) {
                if (code == 399) { // Session Timeout
                    location.href = "#{contextPath}/faces/pages/sessionExpired.xhtml";
                } else {
                    alert("Server failed(");
                }
            }

            function setLayoutDimensions() {
                $j("#center").css({
                   "height": $j(this).outerHeight()
                       - $j("#header").outerHeight()
                       - $j("#top").outerHeight()
                       - $j("#footer").outerHeight()
                });
            }

            function showLoader() {
                $j('#loadingPanel').show();
            }

            function hideLoader() {
                $j('#loadingPanel').hide();
            }
        </script>

        <style>
            table.standard {
                border-bottom: 1px solid #{richSkin.headerBackgroundColor};
            }
            table.standard td {
                border-right-color: #{richSkin.generalBackgroundColor};
            }
            table.standard thead td {
                border-top-color: #{richSkin.headerBackgroundColor};
                color: #{richSkin.headerTextColor};
                border-right-color: #{richSkin.generalBackgroundColor};
            }
        </style>

        <title>
            <ui:insert name="title">OpenL Tablets WebStudio</ui:insert>
        </title>
    </h:head>

    <h:body style="visibility: hidden">
        <div id="header">
            <ui:insert name="header">
                <ui:include src="/pages/common/header.xhtml">
                    <ui:param name="menu" value="repository" />
                </ui:include>
            </ui:insert>
        </div>

        <h:form id="mainForm" prependId="false">
            <div id="top">
                <ui:insert name="top">
                    <ui:include src="/pages/modules/repository/topPanel.xhtml" />
                </ui:insert>
            </div>

            <div id="center">
                <div id="left" class="ui-layout-west">
                    <ui:insert name="left" />
                </div>
                <div id="content" class="ui-layout-center">
                    <ui:insert name="content" />
                </div>
            </div>
        </h:form>

        <div id="footer">
            <ui:insert name="footer">
                <ui:include src="/pages/common/footer.xhtml" />
            </ui:insert>
        </div>

        <ui:insert name="special" />

        <div id="loadingPanel" style="display: none">
            <img src="webresource/images/ajax-loader.gif" />
        </div>

        <a4j:status onstart="showLoader()" onstop="hideLoader()" />
    </h:body>
</html>
