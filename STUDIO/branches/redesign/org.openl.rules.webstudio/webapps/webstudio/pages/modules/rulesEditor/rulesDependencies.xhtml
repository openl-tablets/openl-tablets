<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets">

    <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}" />

    <link rel="stylesheet" type="text/css" href="#{contextPath}/css/rulesDependencies.css"></link>
    <script src="#{contextPath}/javascript/jit-yc.js"></script>
    <!--[if IE]><script src="#{contextPath}/javascript/excanvas.js"></script><![endif]-->
    <script src="#{contextPath}/javascript/rulesDependencies.js"></script>

    <div id="rulesDepsPanel"></div>

    <script>
        <c:set var="tables" value="#{rulesDependenciesBean.tablesWithDependencies}"></c:set>
        <h:panelGroup rendered="#{not empty tables}">

        var nodes = [];
        <ui:repeat var="table" value="#{tables}">
            var node = {
                id: '<h:outputText value="#{table.uri}" />',
                name: '<h:outputText value="#{table.name}" />',
                adjacencies: []
            }

            var adjacencies = [];
            <ui:repeat var="depUri" value="#{table.dependencies}">
                var adjacency = {
                    nodeTo: '<h:outputText value="#{depUri}" />'
                }
                adjacencies.push(adjacency);
            </ui:repeat>

            node.adjacencies = adjacencies;

            nodes.push(node);
        </ui:repeat>

        init(nodes);

        </h:panelGroup>
    </script>

</ui:composition>
