<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:rules="http://openl-tablets.sourceforge.net/jsf"
    template="/facelets/common/webstudioBase.xhtml">

    <ui:define name="header">
        <script type="text/javascript">
            function open_win(url) {
                window.open(url, "_blank", "toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=yes, width=900, height=700, top=20, left=100")
            }
        </script>
        <style>
            form {
                margin: 0px;
            }
        </style>
    </ui:define>

    <ui:define name="page">
        <table>
            <tr>
                <td>
                    <img src="#{contextPath}/webresource/images/excel-workbook.png" />
                    <h:outputLink
                        value="#{contextPath}/jsp/showLinks.jsp?#{showTableBean.url}"
                        title="#{showTableBean.uri}"
                        target="show_app_hidden"
                        rendered="#{showTableBean.editable}">
                        <h:outputText
                            value="#{showTableBean.text}:#{showTableBean.name}" />
                    </h:outputLink>

                    <h:outputText rendered="#{not showTableBean.editable}"
                        value="#{showTableBean.text}:#{showTableBean.name}" />

                    <c:if test="#{showTableBean.runnable and !showTableBean.hasErrors}">
                        <h:outputLink
                            value="#{contextPath}/jsp/runMethod.jsp?elementID=#{showTableBean.elementID}"
                            title="Run">
                            <h:graphicImage url="/webresource/images/test.gif"
                                alt="test" />
                        </h:outputLink>

                        <c:set var="tgUrl"
                            value="#{contextPath}/treeview.jsp?title=Trace&amp;treejsp=tracetree.jsp&amp;relwidth=70&amp;mainjsp=jsp/showTraceTable.jsp&amp;elementID=#{showTableBean.elementID}&amp;first=true" />
                        <a onClick="open_win('#{tgUrl}', 800, 600)"
                            href="#" title="Trace"><img border="0"
                                src="webresource/images/trace.gif"
                                alt="trace" /></a>

                        <h:outputLink
                            value="#{contextPath}/faces/facelets/studio/benchmarkMethod.xhtml?elementID=#{showTableBean.elementID}"
                            title="Benchmark">
                            <h:graphicImage
                                url="/webresource/images/clock-icon.png"
                                alt="benchmark"
                                style="padding-left:5px;" />
                        </h:outputLink>
                    </c:if>

                    <c:if
                        test="#{showTableBean.testable and !showTableBean.hasErrors}">
                        <h:outputLink
                            value="#{contextPath}/jsp/runAllTests.jsp?elementID=#{showTableBean.elementID}"
                            title="Test">
                            <h:graphicImage url="/webresource/images/test_ok.gif"
                                alt="test" />
                        </h:outputLink>
                    </c:if>
                </td>
                <td>
                    <h:outputLink
                        value="?#{showTableBean.notViewParams}">
                        <f:param value="view.business" name="view" />
                        <h:graphicImage
                            url="/webresource/images/business-view.png"
                            title="Business View" alt="Business View" />
                    </h:outputLink>

                    <h:outputLink
                        value="?#{showTableBean.notViewParams}">
                        <f:param value="view.developer" name="view" />
                        <h:graphicImage
                            url="/webresource/images/developer-view.png"
                            title="Developer (Full) View"
                            alt="Full View" style="padding-left:5px;" />
                    </h:outputLink>
                </td>
            </tr>
        </table>

        <ui:include src="/WEB-INF/include/facelets/errorDisplay.xhtml">
            <ui:param name="tableID" value="#{showTableBean.elementID}" />
        </ui:include>

        <c:if test="#{showTableBean.tsnHasErrors}">
            <h3>Problems</h3>
            <table border="1">
                <tr>
                    <td>
                        <h:outputText value="#{showTableBean.errorString}"
                            escape="false" />
                    </td>
                </tr>
            </table>
        </c:if>

        <br />

        <h:outputLink rendered="#{showTableBean.editable}"
            value="#{contextPath}/faces/facelets/tableeditor/showTable.xhtml">
            <f:param name="elementID" value="#{showTableBean.elementID}" />
            <f:param name="mode" value="edit" />
            <f:param name="view" value="#{showTableBean.view}" />
            Edit Table
        </h:outputLink>
        <f:verbatim>&amp;nbsp;</f:verbatim>
        <h:outputLink rendered="#{showTableBean.copyable}"
            value="#{contextPath}/faces/facelets/tableCopier/copyTable.xhtml">
            <f:param name="elementID" value="#{showTableBean.elementID}" />
            Copy Table
        </h:outputLink>
        <br /><br />

        <script type="text/javascript">
            function triggerSearch(f) {
                f.searchQuery.value = $A($(PopupMenu.lastTarget).childNodes).find(function(s) {return s.nodeName == "#text"})
                    .nodeValue.sub(/^[.;,! \t\n()^&amp;*%=?\-'"+&lt;>]+/, "").split(/[.;,! \t\n()^&amp;*%=?\-'"+&lt;>]+/, 3)
                    .reject(function(s) {return !s}).join(" ");
                f.submit();
            }
        </script>

        <form name="searchForm" action="#{contextPath}/jsp/search/search.jsp">
            <input type="hidden" name="searchQuery" value="" />
        </form>

        <rules:tableEditor table="#{showTableBean.table}" mode="#{showTableBean.mode}"
            editable="#{showTableBean.editable}">
            <h:outputLink value="javascript:triggerSearch(document.forms.searchForm)">Search</h:outputLink>
        </rules:tableEditor>

        <c:set value="#{showTableBean.testRunResults}" var="testResult" />
        <c:if test="#{testResult.notEmpty}">
            <h1>
                Select one of the available runs by clicking on it:
            </h1>
            <c:forEach var="test" items="#{testResult.tests}">
                <c:forEach var="description"
                    items="#{test.descriptions}" varStatus="status">
                    <p>
                        <f:verbatim>&amp;nbsp;&amp;nbsp;</f:verbatim>
                        <h:outputLink
                            value="#{contextPath}/jsp/runMethod.jsp"
                            title="Run">
                            <f:param value="#{showTableBean.elementID}"
                                name="elementID" />
                            <f:param value="#{test.testName}"
                                name="testName" />
                            <f:param value="#{status.index}"
                                name="testID" />
                            <f:param value="#{description}"
                                name="testDescr" />
                            <h:graphicImage
                                url="/webresource/images/test.gif"
                                alt="test" />
                        </h:outputLink>
                        <f:verbatim>&amp;nbsp;</f:verbatim>
                        <h:outputLink
                            value="#{contextPath}/faces/facelets/studio/benchmarkMethod.xhtml"
                            title="Benchmark">
                            <f:param value="#{showTableBean.elementID}"
                                name="elementID" />
                            <f:param value="#{test.testName}"
                                name="testName" />
                            <f:param value="#{status.index}"
                                name="testID" />
                            <f:param value="#{description}"
                                name="testDescr" />
                            <h:graphicImage
                                url="/webresource/images/clock-icon.png"
                                alt="test" />
                        </h:outputLink>
                        <f:verbatim>&amp;nbsp;</f:verbatim>
                        <h:outputLink
                            value="#{contextPath}/jsp/runMethod.jsp">
                            <f:param value="#{showTableBean.elementID}"
                                name="elementID" />
                            <f:param value="#{test.testName}"
                                name="testName" />
                            <f:param value="#{status.index}"
                                name="testID" />
                            <f:param value="#{description}"
                                name="testDescr" />
                            <h:outputText value="#{description}" />
                        </h:outputLink>
                    </p>
                </c:forEach>
            </c:forEach>
        </c:if>

    </ui:define>

</ui:composition>