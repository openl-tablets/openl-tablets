<ui:composition
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:rules="http://openl-tablets.sourceforge.net/jsf"
  template="/facelets/common/studioBase.xhtml">
  
  <ui:define name="header">
        <a4j:loadScript src="resource:///js/validation.js" />
        <a4j:loadScript src="resource:///js/BaseEditor.js" />
        <a4j:loadScript src="resource:///js/BaseTextEditor.js" />
        <a4j:loadScript src="resource:///js/MultiselectEditor.js" />
        <a4j:loadScript src="resource:///js/DropdownEditor.js" />
        <a4j:loadScript src="resource:///js/AjaxHelper.js" />
        <a4j:loadStyle src="resource:///css/multiselect.css" />
    </ui:define>      
       
  <ui:define name="page">
  	<table>
		<tr>
			<td valign="bottom"><a href="#{contextPath}/jsp/search/indexSearch.jsp"><font size="-1">Index</font></a></td>
			<td valign="bottom" align="center"><a href="advSearch.xhtml"><font size="-1">Advanced Search</font></a></td>			
		</tr>
	</table>
	<table class="search-table">
	<tr><th>Business Search</th></tr>
	<tr><td>
	<h:form id="businessSearchForm">
	<fieldset><legend>Properties</legend>  
		<table id="propertySearchTable">
			<a4j:repeat value="#{bussinessSearch.propForSearch}" var="prop">
				<tr>
                    <td><h:outputText value="#{prop.displayName}"/></td>
                    <td>
	                 	<rich:calendar value="#{prop.value}" 
	                       			   datePattern="#{prop.format}"
	                       			   defaultTime="00:00" 
	                       			   timeZone="#{formatPatterns.defaultTimeZone}" rendered="#{prop.date}" />
                		
                		<h:outputText binding="#{bussinessSearch.enumHelper.enumOutput}" escape="false" 
                					value="#{bussinessSearch.enumHelper.enumValue}" rendered="#{prop.enum}">
                            <f:attribute name="property" value="#{prop}"/>
                        </h:outputText>
                        <h:inputHidden value="#{prop.stringValue}" rendered="#{prop.enum}" />

                		<h:outputText binding="#{bussinessSearch.enumHelper.enumArrayOutput}" escape="false" 
                					value="#{bussinessSearch.enumHelper.enumArrayValue}" rendered="#{prop.enumArray}">
                            <f:attribute name="property" value="#{prop}"/>
                        </h:outputText>
                        <h:inputHidden value="#{prop.stringValue}" rendered="#{prop.enumArray}" />

           		    	<h:inputText value="#{prop.value}" rendered="#{!(prop.date || prop.name == 'version' || prop.boolean || prop.enum || prop.enumArray)}"/>
               		    
                        <input type="hidden" name="id" value="#{prop.name}" />
                    </td>
				</tr>
			</a4j:repeat>
		</table>
	</fieldset>
	<br/>
	<fieldset>
		<h:panelGrid columns="2" cellspacing="5" >
			<h:outputLabel for="content" value="Table Contains" />
			<h:inputText id="content" value="#{bussinessSearch.tableContain}" />
		</h:panelGrid>
	</fieldset>
	<br />
	<h:commandButton value="Search" action="#{bussinessSearchRequest.search}"/>
	</h:form></td></tr>
	</table>
	
	<c:if test="#{not bussinessSearch.ready}">
  		<p class="warning">There is no valid projects in workspace. Or your session have expired and you need to reload project</p>
	</c:if>
	<c:if test="#{bussinessSearchRequest.searching}">
    	<c:forEach items="#{bussinessSearchRequest.searchResults}" var="tableSearch">
        <br />
        <h:panelGroup rendered="#{not bussinessSearch.studioReadOnly}">
            <img src="#{contextPath}/webresource/images/excel-workbook.png" />
            <h:outputText value="#{tableSearch.xlsLink}" escape="false" />
        </h:panelGroup>
        <br />
        <h:panelGroup>
            <img src="#{contextPath}/webresource/images/viewTable.gif" />
            <h:outputLink value="#{contextPath}/faces/facelets/tableeditor/showTable.xhtml">
                <f:param name="uri" value="#{tableSearch.tableUri}" />
                <h:outputText value="View Table" />
            </h:outputLink>
        </h:panelGroup>
        <br /><br />
        <rules:tableEditor table="#{tableSearch.table}" editable="false" rendered="#{tableSearch.table != null}"
            collapseProps="true">
            <h:outputLink value="javascript:triggerSearch(document.forms.searchForm)">Search</h:outputLink>
        </rules:tableEditor>
        <h:outputText value="No rows selected&lt;br/&gt;" rendered="#{tableSearch.table == null}" escape="false" />
     </c:forEach>

	   </c:if>
	
</ui:define>
</ui:composition>