<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
   xmlns:f="http://java.sun.com/jsf/core"
   xmlns:h="http://java.sun.com/jsf/html"
   xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
   xmlns:rich="http://richfaces.ajax4jsf.org/rich"
   xmlns:c="http://java.sun.com/jstl/core"
   xmlns:ui="http://java.sun.com/jsf/facelets">

  <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}"/>
  <c:set var="node" value="#{repositoryTreeState.selectedNode}"/>
  <c:set var="artefact" value="#{node.dataBean}"/>

  <head>
    <a4j:loadStyle src="/css/default.css" />
    <a4j:loadScript src="/javascript/common.js" />
    <script>
      function ajaxRequestContainsErrors() {
        return document.getElementById("severityForm:maximumSeverity").value >= 2;
      }

      var actionCallback = function() { }

      function onComplete() {
        if (!ajaxRequestContainsErrors()) {
          actionCallback();
        }
      }

      function submitMainForm(callback) {
        actionCallback = callback;
        document.getElementById('mainForm:submitButton').click();
      }
    </script>
    <style>
      input.button { background-image: url(#{contextPath}/images/button_#{skinBean.skin}.gif); }
      input.readonlyRowInput { background-color: #{a4jSkin.generalBackgroundColor}; }
      table.standard { border-bottom: 1px solid #{a4jSkin.headerBackgroundColor}; }
      table.standard td { border-right-color: #{a4jSkin.generalBackgroundColor}; }
      table.standard thead td { border-top-color: #{a4jSkin.headerBackgroundColor}; color: #{a4jSkin.headerTextColor}; border-right-color: #{a4jSkin.generalBackgroundColor}; }
    </style>
    <title><ui:insert name="title">OpenL Web Studio</ui:insert></title>
  </head>

  <body>
    <a4j:outputPanel id="severityFormPanel" ajaxRendered="true">
      <h:form id="severityForm" style="display:none">
        <h:inputHidden id="maximumSeverity" value="#{facesContext.maximumSeverity.ordinal}" />
      </h:form>
    </a4j:outputPanel>

    <h:form id="mainForm">
      <a4j:commandButton id="submitButton" reRender="severityFormPanel, nodeView" oncomplete="onComplete()"
        ajaxSingle="false" style="display:none;"/>
      <ui:include src="/common/header.xhtml" />
      <ui:insert name="body" />
    </h:form>

    <ui:insert name="special" />
  </body>
</html>
